<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta property="og:type" content="website">
<meta property="og:title" content="Zhu Chenghao&#39;s Blog">
<meta property="og:url" content="http://zchgql.com/page/3/index.html">
<meta property="og:site_name" content="Zhu Chenghao&#39;s Blog">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Zhu Chenghao&#39;s Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://zchgql.com/page/3/"/>





  <title>Zhu Chenghao's Blog</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zhu Chenghao's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Deep Learning/Machine Learning/NLP/Linguistics</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zchgql.com/2017/12/23/Surf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhu Chenghao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhu Chenghao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/23/Surf/" itemprop="url">OPENCV-SURF算法简介</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-23T12:03:09+08:00">
                2017-12-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>SURF 是一种兴趣点检测及描述子算法。可以说是对SIFT算法的加强版。是用来实现尺度不变性特征点的检测与匹配任务的，SURF算法首先利用Hessian矩阵确定候选点，然后进行NMS（非极大值抑制）初步确定特征点，再通过确定特征点主方向，综合构造SURF特征点描述算子从而进行图像特征抽取。</p>
<h1 id="SURF方法的具体实现"><a href="#SURF方法的具体实现" class="headerlink" title="SURF方法的具体实现"></a>SURF方法的具体实现</h1><h2 id="Hessian矩阵简介"><a href="#Hessian矩阵简介" class="headerlink" title="Hessian矩阵简介"></a>Hessian矩阵简介</h2><p>在数学中，<strong>海森矩阵</strong>（Hessian matrix 或 Hessian）是一个多变量实值函数的二阶偏导数组成的方块矩阵，描述了函数的局部曲率。假设有一实数函数f(x1, ,x2, x3, ….xn)，如果 f 所有的二阶偏导数都存在，那么  f  的海森矩阵的第 ij 项即：</p>
<p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/376f63ba327a32b89317226051808ea857992cad" alt=""></p>
<p>其中x = (x1, x2, x3, x4, …,xn )，即</p>
<p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/389411defb8c9662a366a1d87c25c197c1c56dc4" alt=""></p>
<p>海森矩阵的行列式，可用于分辨 f 的临界点是属于鞍点还是极值点。</p>
<p>对于 f 的临界点 (x0, y0) 一点，有<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/cff30491b15467e68444e86538651370bd571e0d" alt="{\frac  {\partial f(x_{0},y_{0})}{\partial x}}={\frac  {\partial f(x_{0},y_{0})}{\partial y}}=0">，然而凭一阶导数不能判断它是鞍点、局部极大点还是局部极小点。海森矩阵可能解答这个问题。</p>
<p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/31f604c36c3f1e37efe8287d7848c797b09484fd" alt=""></p>
<ul>
<li><p>H &gt; 0：</p>
<p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/df873e9e76d5a3c14f76660e3bc9faa2d14e0aee" alt="{\frac  {\partial ^{2}f}{\partial x^{2}}}&gt;0"></p>
<p>则 (x0, y0) 是局部极小点</p>
<p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/7b29b1c5e99c1d6836ca2246a77414ec32a973e8" alt="{\frac  {\partial ^{2}f}{\partial x^{2}}}&lt;0"></p>
<p>则 (x0, y0) 是局部极大点。</p>
</li>
<li><p>H &lt; 0：(x0, y0) 是鞍点。</p>
</li>
<li><p>H = 0：二阶导数无法判断该临界点的性质，得从更高阶的导数以泰勒公式考虑。</p>
</li>
</ul>
<h2 id="SURF中Hessian矩阵的构建"><a href="#SURF中Hessian矩阵的构建" class="headerlink" title="SURF中Hessian矩阵的构建"></a>SURF中Hessian矩阵的构建</h2><p>我们假设一个函数f(x, y)，那么图像中像素点的Hessian矩阵我们表示为：</p>
<p><img src="http://img.blog.csdn.net/20131127162720250" alt=""></p>
<p>从而每一个像素点都可以求出一个Hessian矩阵。Hessian矩阵判别式为：</p>
<p><img src="http://img.blog.csdn.net/20131127162900312" alt=""></p>
<p>在SURF算法中，通常用图像像素I(x,y)取代函数值f(x,y)。然后选用二阶标准高斯函数作为滤波器。</p>
<p>使用高斯滤波的原因是我们要求我们的特征点具有尺度无关性，所以我们在进行Hessian矩阵构造之前做一次高斯滤波，用高斯核和函数图像在x处卷积来实现，这样我们就有：</p>
<p><img src="http://img.blog.csdn.net/20131127184804390" alt=""></p>
<p>其中 G(t)为高斯核，g(t)为高斯函数，t 为高斯方差：</p>
<p><img src="http://img.blog.csdn.net/20131127184739281" alt=""></p>
<p>这样通过特定核间的卷积计算二阶偏导数，又能计算出H矩阵的三个矩阵元素Lxx, Lxy, Lyy，从而计算出H矩阵公式如下：</p>
<p><img src="http://img.blog.csdn.net/20131127184650203" alt=""></p>
<p>通过这种方法可以为图像中每个像素计算出其H矩阵的决定值，并用这个值来判别特征点。</p>
<p>这里SURF提出用近似的值代替L(x,t)，即可以将高斯二阶梯度模板用盒函数来近似：</p>
<p><img src="http://img.blog.csdn.net/20151028181456547?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p>比如说y方向上的模板Fig1(a)与Fig1(c)。Fig1(a)即用高斯平滑后在y方向上求二阶导数的模板。为了加快运算用了近似处理，其处理结果如Fig1(b)所 示，这样就简化了很多。关键是可以使用积分图来进行运算！</p>
<h2 id="积分图"><a href="#积分图" class="headerlink" title="积分图"></a>积分图</h2><p>SURF是对积分图像进行操作，从而实现了加速，采用盒子滤波器计算每个像素点的Hessian矩阵行列式时，只需要几次加减法运算，而且运算量与盒子滤波器大小无关，所以能够快速的构成出SURF的尺度金字塔。</p>
<p>积分图像中每个像元的值，是原图像上对应位置的左上角所有元素之和</p>
<p><img src="http://img.blog.csdn.net/20160825155743997" alt="img"></p>
<p>如上图：我们要得到绿色矩形区域内的矩形像素之和S，只需要在积分图上，运算S=D-B-C+A就可以得到。</p>
<h2 id="尺度空间"><a href="#尺度空间" class="headerlink" title="尺度空间"></a>尺度空间</h2><p>图像的尺度空间是这幅图像在不同解析度下的表示。上面讲的这么多只是得到了一张近似Hessian行列式图，但是在金字塔图像中分为很多层，每一层叫做一个octave，每一个octave中又有几张尺度不同的。</p>
<p>尺度空间通常通过高斯金字塔来实施，图像需要被重复高斯平滑，然后经过不断子采样，一层一层直到塔顶，如sift方法。而SUFR通过盒函数和积分图像，我们就不需要像SIFT方法那样，每组之间需要采样，而且还需要对当前组应用同上层组相同的滤波器，而SURF方法不需要进行采样操作，直接应用不同大小的滤波器就可以了。</p>
<p><img src="http://img.blog.csdn.net/20131127194541250" alt=""></p>
<p>在SURF中，图片的大小是一直不变的，不同的octave层得到的待检测图片是改变高斯模糊尺寸大小得到的。左边是传统方式建立一个如图所示的金字塔结构，图像的寸是变化的，并且运算会反复使用高斯函数对子层进行平滑处理，上图右边说明SURF算法使原始图像保持不变而只改变滤波器大小。SURF采用这种方法节省了降采样过程，其处理速度自然也就提上去了。卷积滤波器大小变化图：</p>
<p><img src="http://img.blog.csdn.net/20151102153457072" alt=""></p>
<p>在SURF特征检测算法中,尺度空间金字塔的最底层由9x9的盒子滤波输出得到,对应二阶高斯滤波σ=1.2。为保证盒子滤波的结构不变,后续滤波器的大小最少要有6个像素值步长的变化.</p>
<p>每4个模板为一阶(Octave)。第1阶中,相邻的模板尺寸相差6个像素,第2阶中相差12个像素,第3阶中相差24个像素,以此类推。每一阶的第一个模板尺寸是上一阶的第二个模板的尺寸。因为兴趣点的数量在尺度的方向上退化很快,所以一般情况下取4个Octave就足够了</p>
<p><img src="http://img.blog.csdn.net/20151102143538320" alt=""></p>
<h2 id="非极大值抑制"><a href="#非极大值抑制" class="headerlink" title="非极大值抑制"></a>非极大值抑制</h2><p>非极大值抑制在说目标检测的那篇提到了，这里直接说如何使用。将经过hessian矩阵处理过的每个像素点与其三维领域的26个点进行大小比较，如果它是这26个点中的最大值或者最小值，则保留下来，当做初步的特征点。</p>
<p>检测过程中使用与该尺度层图像解析度相对应大小的滤波器进行检测，以3×3的滤波器为例，该尺度层图像中9个像素点之一。如下图中检测特征点与自身尺度层中其余8个点和在其之上及之下的两个尺度层9个点进行比较，共26个点，图中标记‘x’的像素点的特征值若大于周围像素则可确定该点为该区域的特征点。</p>
<p>注意是三维领域哦！</p>
<p><img src="http://img.blog.csdn.net/20131127210424156" alt=""></p>
<p>然后，采用3维线性插值法得到亚像素级的特征点，同时也去掉那些值小于一定阈值的点，增加极值使检测到的特征点数量减少，最终只有几个特征最强点会被检测出来。</p>
<h2 id="特征点方向特征的确定"><a href="#特征点方向特征的确定" class="headerlink" title="特征点方向特征的确定"></a>特征点方向特征的确定</h2><p>为使兴趣点描述算子具有旋转不变的性能,首先要赋予每一个兴趣点方向特征。</p>
<p>我们在以某个兴趣点为圆心,以6S(S为该兴趣点对应的尺度)为半径的圆形邻域里,用尺寸为4S的Haar小波模板对图像进行处理,求x、y两个方向的Haar小波响应。</p>
<p>Haar小波的模板如下图所示,其中左侧模板计算x方向的响应,右侧模板计算y方向的响应,黑色表示一1,白色表示+1。</p>
<p><img src="http://img.blog.csdn.net/20151102191407971" alt=""></p>
<p>用Haar小波滤波器对圆形邻域进行处理后,就得到了该邻域内每个点所对应的x、y方向的响应,然后用以兴趣点为中心的高斯函数(σ=2s)对这些响应进行加权。用一个圆心角为PI/3扇形以兴趣点为中心环绕一周,计算该扇形处于每个角度时，</p>
<p>它所包括的图像点的Haar小波响应之和。由于每一点都有x、y两个方向的响应,因此扇形区域中所有点的响应之和构成一个矢量。把扇形区域环绕一周所形成的矢量都记录下来,取长度最大的矢量,其方向即为该兴趣点所对应的方向。</p>
<p><img src="http://img.blog.csdn.net/20151102190801811" alt=""></p>
<p><img src="http://img.blog.csdn.net/20131127210454218" alt=""></p>
<h2 id="构造SURF特征描述算子"><a href="#构造SURF特征描述算子" class="headerlink" title="构造SURF特征描述算子"></a>构造SURF特征描述算子</h2><p>在SURF中，也是在特征点周围取一个正方形框，框的边长为20s(s是所检测到该特征点所在的尺度)。该框带方向，方向当然就是第4步检测出来的主方向了。</p>
<p>然后把该框分为16个子区域，每个子区域统计25个像素的水平方向和垂直方向的haar小波特征，这里的x(水平)和y(垂直)方向都是相对主方向而言的。</p>
<p>该haar小波特征为x(水平)方向值之和，水平方向绝对值之和，垂直方向之和，垂直方向绝对值之和。该过程的示意图如下所示：</p>
<p><img src="http://img.blog.csdn.net/20131127211200250" alt=""></p>
<h2 id="OPENCV实现"><a href="#OPENCV实现" class="headerlink" title="OPENCV实现"></a>OPENCV实现</h2><h3 id="Opencv-Python实现"><a href="#Opencv-Python实现" class="headerlink" title="Opencv-Python实现"></a>Opencv-Python实现</h3><p><a href="https://github.com/ZZZZZch/ImgThracker" target="_blank" rel="noopener">https://github.com/ZZZZZch/ImgThracker</a></p>
<h3 id="实际效果图"><a href="#实际效果图" class="headerlink" title="实际效果图"></a>实际效果图</h3><p>选用邹博微博中的图片，右下角为效果截图。</p>
<p><img src="https://wx1.sinaimg.cn/mw690/8974ecb3ly1fmoxobg6kij20hj0dv48y.jpg" alt=""></p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="http://blog.csdn.net/tezhongjunxue/article/details/17040779" target="_blank" rel="noopener">【图像分析】SURF特征提取分析</a></li>
<li><a href="http://blog.csdn.net/tostq/article/details/49472709" target="_blank" rel="noopener">SURF算法详解及同SIFT算法的比较</a></li>
<li><a href="http://www.cnblogs.com/walccott/p/4956857.html" target="_blank" rel="noopener">SURF特征点监测</a></li>
<li>《Speeded-Up Robust Features》Herbert Bay</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Zhu Chenghao" />
          <p class="site-author-name" itemprop="name">Zhu Chenghao</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">tags</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhu Chenghao</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
